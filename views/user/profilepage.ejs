<!DOCTYPE html>
<html lang="en">
<head>
    <title>User Profile</title>
    <link rel="stylesheet" href="/css/profile.css">
    <!-- Latest compiled and minified CSS -->
<style>/* Style for the container */
    .container-profile {
        display: flex;
    }
    
    /* Style for the side panel */
    .sidePanel {
        width: 30%; /* Adjust width as needed */
        background-color: #f1f1f1;
    }
    
    /* Style for tab buttons */
    .sidePanel button {
        display: block;
        width: 100%;
        padding: 10px;
        text-align: left;
        border: none;
        outline: none;
        background-color: transparent;
        cursor: pointer;
        transition: background-color 0.3s;
        font-size: 16px;
    }
    
    .sidePanel button:hover {
        background-color: #ddd;
    }
    
    /* Style for tab content */
    .mainContent {
        flex: 1;
        padding: 20px;
    }
    
    .tabContent {
        display: none;
        padding: 20px;
        border: 1px solid #312e2e;
        font-size: 18px;
    }
    /* Style for the side panel */
.sidePanel {
    float: left;
    width: 20%;
    background-color: #f1f1f1;
}
.activeTab {
    background-color: #ddd;
}
/* Style for tab content */
.tabContent {
    display: none;
    padding: 20px;
    border: 1px solid #1e1c1c;
}
.activeTab .tabContent {
    display: block;
}

</style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
</head>
<body>
    <header>
        <!-- Header content, similar to the previous header -->
        <%-include('header') %>



    </header>
            </div>
            </section>
      
    </div>
    <div class="container-profile">
        <div class="sidePanel">
            <button onclick="openTab('userDetailsTab')"class="tabButton activeTab">User Information</button>
            <button onclick="openTab('addressTab')"class="tabButton">Address</button>
            <!-- <button onclick="openTab('walletTab')"class="tabButton">Wallet</button> -->

            <!-- <button onclick="openTab('ordersTab')"class="tabButton">Orders</button> -->
            <button class="tabButton"><a href="/yourorders" style="text-decoration: none;color: black;">Orders</a></button>

            <button onclick="openTab('passwordTab')"class="tabButton">Change Password</button>
        </div>
        <div class="mainContent">
            <!-- ... (content for different tabs) ... -->
         <!-- <div class="container">
        Profile Section -->
        <div id="userDetailsTab" class="tabContent activeTab">
            <h2>User Information</h2>
            <div>
                <section id="userDetails">
                    <span id="userId" style="display: none;"><%= userId %></span>

                    <label>First Name:</label>

                    <!-- <span id="userId"><%= userId %></span> -->
                    <span id="firstname"><%= userData.firstname %></span>
                    <button onclick="editField('firstname')">Edit</button>
                    <div id="firstnameEdit" style="display: none;">
                        <input type="text" id="firstnameInput" value="<%= userData.firstname %>">
                        <button onclick="saveEdit('firstname')">Save</button>
                    </div>
<br>                    <label>Last Name:</label>

                    <span id="lastname"><%= userData.lastname %></span>
                    <button onclick="editField('lastname')">Edit</button>
                    <div id="lastnameEdit" style="display: none;">
                        <input type="text" id="lastnameInput" value="<%= userData.lastname %>">
                        <button onclick="saveEdit('lastname')">Save</button>
                    </div>
                    <br>
                    <label>Mobile No:</label>

                    <span id="mobile"><%= userData.mobile %></span>
                    <button onclick="editField('mobile')">Edit</button>
                    <div id="mobileEdit" style="display: none;">
                        <input type="text" id="mobileInput" value="<%= userData.mobile %>">
                        <button onclick="saveEdit('mobile')">Save</button>
                    </div>
                    <br>
                    <label>Email:</label>
                    <span id="emailDisplay"><%= userData.email %></span>
                </div> 
            </div>
        </div>

    <!-- Address Modal -->
    <div id="addressTab" class="tabContent">
        <section id="showAddress">
            <section id="addressSection">

        
  <h3>User Addresses</h3>
                <div style="display: flex; flex-wrap: wrap; justify-content: space-around;">
                    <% if(address.length>0) { %>
                    
                    <% address.forEach(function(address, index) { %>
                      <label style="flex: 0 0 48%; margin: 1%; border: 1px solid #ccc; padding: 10px; box-sizing: border-box; text-align: left;">
                        <input type="radio" name="deliveryAddress" value="<%= index %>">
                        <strong style="font-size: 1.2em;">Address <%= index + 1 %>-<%= address.housename %></strong><br>
                        <strong>House Name:</strong> <%= address.housename %><br>
                        <strong>Street Name:</strong> <%= address.streetname %><br>
                        <strong>Post Office:</strong> <%= address.postoffice %><br>
                        <strong>City:</strong> <%= address.city %><br>
                        <strong>State:</strong> <%= address.state %><br>
                        <strong>Pincode:</strong> <%= address.pincode %><br>
                      </label>

                    <% }); %>
                    <% } %>
                  </div>
                  <br>
                  <div style="font-size: 1.5rem;">
                    <strong>
                      <a href="/profile/addAddress" style="text-decoration: none; color: black;">
                        <span style="margin-right: 5px;">+</span> Add New Address
                      </a>
                    </strong>
                  </div>
                </section>
        <!-- Wallet Tab -->
       
        <div id="walletTab" class="tabContent">
            <section id="wallet">
            <h2>Wallet Information</h2>
           

            <!-- Add your wallet information and transaction history here -->
            <!-- For example: -->
            <p>Balance: $100</p>
            <h3>Transaction History</h3>
            <!-- Add transaction history details here -->
        </div>
        </section>

    </div>

 <div id="passwordTab" class="tabContent">
    <section id="changePassword">
        <h2>Change Password</h2>
        <form id="changePasswordForm" onsubmit="changePassword()">
            <input type="hidden" id="userIdInput" value="<%= userId %>"> <!-- Add this line to include the user ID -->
            <label for="currentPassword">Current Password:</label>
        <input type="password" id="currentPassword" name="currentPassword">
        <label for="newPassword">New Password:</label>
        <input type="password" id="newPassword" name="newPassword" required>
        <label for="confirmPassword">Confirm New Password:</label>
        <input type="password" id="confirmPassword" name="confirmPassword" required>
            <button type="submit">Change Password</button>
        </form>
    </section>
</div>


    
    




   

    
    <script src="script.js"></script>
    <script>
        function editField(fieldName) {
            // Hide the original span and show the input field
            document.getElementById(fieldName).style.display = 'none';
            document.getElementById(fieldName + 'Edit').style.display = 'block';
        
            // Focus on the input field
            document.getElementById(fieldName + 'Input').focus();
        }
        
        function saveEdit(fieldName) {
            // Get the value from the input field
            var editedValue = document.getElementById(fieldName + 'Input').value;
        
            // Update the original span with the new value
            document.getElementById(fieldName).innerText = editedValue;
        
            // Hide the input field and show the original span
            document.getElementById(fieldName).style.display = 'inline';
            document.getElementById(fieldName + 'Edit').style.display = 'none';
            sendUpdateToServer(fieldName,editedValue)
            // Here, you can send the updated value to the server for database update
            // using a fetch or AJAX request
            // Example: sendUpdateToServer(fieldName, editedValue);
        
        
        // Example function for sending data to the server
        async function sendUpdateToServer(fieldName, editedValue) {
            // Use fetch or AJAX to send the updated value to the server
            // This is where you'll handle the server-side update
            var userIdValue = document.getElementById('userId').innerText;
            console.log(userIdValue+"useridvalue");
            await fetch(`/updateUserDetails/${userIdValue}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ field: fieldName, value: editedValue }),
            })
            .then(response => {
                if (response.ok) {
                    console.log('Update successful');
                } else {
                    console.error('Failed to update');
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }}
    
    async function changePassword() {
        const userId = document.getElementById('userIdInput').value; // Get user ID from the hidden input
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
    
        // Add any additional client-side validation if needed
    
        const response = await fetch(`/changePassword/${userId}`, { // Pass user ID in the URL
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                currentPassword,
                newPassword,
                confirmPassword,
            }),
        });
    
        const result = await response.json();
    
        // Handle the server response, show success or error messages
        console.log(result);
    }
</script>

<script>
function openTab(tabName) {
    var i, tabContent;
    tabContent = document.getElementsByClassName("tabContent");
    for (i = 0; i < tabContent.length; i++) {
        tabContent[i].style.display = "none";
    }
    document.getElementById(tabName).style.display = "block";
}

// Show the "Profile Section" tab when the profile page loads
window.onload = function() {
    // Add the ID of the profile tab you want to display initially
    document.getElementById('userDetailsTab').style.display = 'block';
};



///Add New Address
// document.getElementById('addAddressForm').addEventListener('submit',async function(event) {
//     event.preventDefault(); // Prevent the default form submission
    
   
//     const formData=new FormData(this)

   
//     // Send a POST request to the backend API
//     console.log(formData);
//     const response=await fetch('/addAddress', {
//         method: 'POST',
//         body:new URLSearchParams(formData),
//         headers: {
//             'Content-Type': 'application/x-www-form-urlencoded'
//         }
//     })
//     const result=await response.json()
//     if(result.success){
//         document.getElementById('addAddressForm').reset();
//     }
//     else{
//         console.error('Error:');
//     }
    // .then(response => {
    //     if (response.ok) {
    //         console.log('Address added successfully');
    //         // Reset the form after successful submission
    //         document.getElementById('addAddressForm').reset();
    //     } else {
    //         throw new Error('Failed to add address');
    //     }
    // })
    // .catch(error => {
    //     console.error('Error:', error);
    // });
// });
    </script>
</body>
</html>
